---
layout: post
category: java
title: Stack Overflow ä¸Š 370ä¸‡æµè§ˆé‡çš„ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•æ¯”è¾ƒ Java çš„å­—ç¬¦ä¸²ï¼Ÿ
tagline: by æ²‰é»˜ç‹äºŒ
tag: java
---

åœ¨é€› Stack Overflow çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€äº›è®¿é—®é‡åƒå–œé©¬æ‹‰é›…å±±ä¸€æ ·é«˜çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´è¿™ä¸ªï¼šå¦‚ä½•æ¯”è¾ƒ Java çš„å­—ç¬¦ä¸²ï¼Ÿè®¿é—®é‡è¶³è¶³æœ‰ 370ä¸‡+ï¼Œè¿™ä¸å¾—äº†å•Šï¼è¯´æ˜æœ‰å¾ˆå¤šå¾ˆå¤šçš„ç¨‹åºå‘˜è¢«è¿™ä¸ªé—®é¢˜å›°æ‰°è¿‡ã€‚

<!--more-->

PSï¼šç³»åˆ—æ–‡ç« å›é¡¾ï¼šã€Š[Stack Overflow ä¸Š250ä¸‡æµè§ˆé‡çš„ä¸€ä¸ªé—®é¢˜ï¼šä½ å¯¹è±¡ä¸¢äº†](https://mp.weixin.qq.com/s/PBqR_uj6dd4xKEX8SUWIYQ)ã€‹

æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹æé—®è€…çš„é—®é¢˜ï¼š

>æˆªæ­¢åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨â€œ==â€æ“ä½œç¬¦æ¥æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œç›´åˆ°ç¨‹åºå‡ºç°äº†ä¸€ä¸ª bugï¼Œéœ€è¦ä½¿ç”¨ `.equals()` æ–¹æ³•æ¥è§£å†³ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿâ€œ==â€æ“ä½œç¬¦å’Œ `.equals()` æ–¹æ³•ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

å’Œæé—®è€…ç›¸åï¼Œåœ¨æˆ‘åˆšå¼€å§‹å­¦ä¹  Java çš„æ—¶å€™ï¼Œæ¯”è¾ƒå­—ç¬¦ä¸²ä¸€ç›´ä½¿ç”¨çš„æ˜¯ `.equals()` æ–¹æ³•ï¼Œå› ä¸ºä¸ç®¡æ˜¯ä¹¦æœ¬è¿˜æ˜¯è€å¸ˆï¼Œéƒ½å‘Šè¯«æˆ‘ä¸è¦ç›´æ¥ä½¿ç”¨â€œ==â€æ“ä½œç¬¦æ¥æ¯”è¾ƒï¼Œä¼šå‡º bugã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œä¹¦æœ¬å’Œè€å¸ˆéƒ½æ²¡æœ‰å¸®æˆ‘ææ¸…æ¥šã€‚

é‚£å€Ÿæ­¤æœºä¼šï¼Œæˆ‘å°±æ¥æ¢³ç†ä¸€ä¸‹ Stack Overflow ä¸Šçš„é«˜èµç­”æ¡ˆï¼Œæˆ‘ä»¬æ¥ä¸€èµ·å­¦ä¹ è¿›æ­¥ï¼Œæ‰“æ€ªå‡çº§ã€‚

- â€œ==â€æ“ä½œç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨ï¼ˆå†…å­˜ä¸­çš„å­˜æ”¾åœ°å€ï¼‰æ˜¯å¦ç›¸ç­‰ï¼Œå®ƒä»¬æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

- `.equals()` ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚

æ€ä¹ˆç†è§£è¿™ä¸¤å¥è¯å‘¢ï¼Ÿæˆ‘æ¥ä¸¾ä¸ªä¸æ°å½“åˆå¾ˆæ°å½“çš„ä¾‹å­ã€‚

æœ‰ä¸€å¯¹åŒèƒèƒï¼Œå§å§å«é˜¿ä¸½å¡”ï¼Œå¦¹å¦¹å«æ´›ä¸½å¡”ã€‚æˆ‘ä»¬æ™®é€šäººçš„çœ¼ç›å®Œå…¨æ— æ³•åˆ†è¾¨è°æ˜¯å§å§è°æ˜¯å¦¹å¦¹ï¼Œå¯å¥¹ä»¬çš„å¦ˆå¦ˆå´å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°è¾¨è®¤å‡ºã€‚


![](http://www.itwanger.com/assets/images/2019/12/java-string-compare-2.png)

`.equals()` å°±å¥½åƒæˆ‘ä»¬æ™®é€šäººï¼Œçœ‹è§é˜¿ä¸½å¡”ä»¥ä¸ºæ˜¯æ´›ä¸½å¡”ï¼Œçœ‹è§æ´›ä¸½å¡”ä»¥ä¸ºæ˜¯é˜¿ä¸½å¡”ï¼Œçœ‹èµ·æ¥ä¸€æ ·å°±è§‰å¾—å¥¹ä»¬æ˜¯åŒä¸€ä¸ªäººï¼›â€œ==â€æ“ä½œç¬¦å°±å¥½åƒå¥¹ä»¬çš„å¦ˆå¦ˆï¼Œè¦æ±‚æ›´ä¸¥æ ¼ï¼Œè§‚å¯Ÿæ›´ç»†è‡´ï¼Œä¸€çœ¼å°±èƒ½åˆ†è¾¨å‡ºè°æ˜¯å§å§è°æ˜¯å¦¹å¦¹ã€‚

```java
String alita = new String("å°èè‰");
String luolita = new String("å°èè‰");

System.out.println(alita.equals(luolita)); // true
System.out.println(alita == luolita); // false
```

å°±ä¸Šé¢è¿™æ®µä»£ç æ¥è¯´ï¼Œ`.equals()` è¾“å‡ºçš„ç»“æœä¸º trueï¼Œè€Œâ€œ==â€æ“ä½œç¬¦è¾“å‡ºçš„ç»“æœä¸º falseâ€”â€”å‰è€…æ²¡åè€…è¦æ±‚é‚£ä¹ˆä¸¥æ ¼ã€‚

å¤§å®¶éƒ½çŸ¥é“ï¼ŒJava çš„æ‰€æœ‰ç±»éƒ½é»˜è®¤åœ°ç»§æ‰¿ç€ Object è¿™ä¸ªè¶…ç±»ï¼Œè¯¥ç±»æœ‰ä¸€ä¸ªåä¸º `.equals()` çš„æ–¹æ³•ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
public boolean equals(Object obj) {
    return (this == obj);
}
```

å¯ä»¥çœ‹å¾—å‡ºï¼ŒObject ç±»çš„ `.equals()` æ–¹æ³•é»˜è®¤é‡‡ç”¨çš„æ˜¯â€œ==â€æ“ä½œç¬¦è¿›è¡Œæ¯”è¾ƒã€‚å‡å¦‚å­ç±»æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆâ€œ==â€æ“ä½œç¬¦å’Œ `.equals()` æ–¹æ³•çš„åŠŸæ•ˆå°±å®Œå…¨ä¸€æ ·â€”â€”æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€æˆ–è€…å¯¹è±¡çš„å¼•ç”¨æ˜¯å¦ç›¸ç­‰ã€‚

ä½†å®é™…æƒ…å†µä¸­ï¼Œæœ‰ä¸å°‘ç±»é‡å†™äº† `.equals()` æ–¹æ³•ï¼Œå› ä¸ºæ¯”è¾ƒå†…å­˜åœ°å€å¤ªé‡äº†ï¼Œä¸å¤ªç¬¦åˆç°å®çš„åœºæ™¯éœ€æ±‚ã€‚String ç±»å°±é‡å†™äº† `.equals()` æ–¹æ³•ï¼Œæºç å¦‚ä¸‹æ‰€ç¤ºã€‚

```java
public boolean equals(Object anObject) {
    if (this == anObject) {
        return true;
    }
    if (anObject instanceof String) {
        String anotherString = (String)anObject;
        int n = value.length;
        if (n == anotherString.value.length) {
            char v1[] = value;
            char v2[] = anotherString.value;
            int i = 0;
            while (n-- != 0) {
                if (v1[i] != v2[i])
                    return false;
                i++;
            }
            return true;
        }
    }
    return false;
}
```

å¯ä»¥çœ‹å¾—å‡ºï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡â€œ==â€ï¼Œé‚£ä¹ˆ `.equals()` çš„ç»“æœå°±ä¸º trueï¼›å¦åˆ™çš„è¯ï¼Œå°±æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚

å¤§å®¶åº”è¯¥éƒ½çŸ¥é“äº†ï¼Œåˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æœ‰ä¸¤ç§å†™æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```java
String luolita = "å°èè‰";
String alita = new String("å°èè‰");
```

ç¬¬ä¸€ç§æ˜¯åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆå­˜å‚¨åœ¨æ–¹æ³•åŒºï¼‰ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ luolitaã€‚ç¬¬äºŒç§æ˜¯é€šè¿‡ new å…³é”®å­—åœ¨å †ä¸­åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•ç”¨èµ‹å€¼ç»™ alitaã€‚

PSï¼šå­—ç¬¦ä¸²ä½œä¸ºæœ€åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œå¦‚æœæ¯æ¬¡éƒ½é€šè¿‡ new å…³é”®å­—è¿›è¡Œåˆ›å»ºï¼Œä¼šè€—è´¹é«˜æ˜‚çš„æ—¶é—´å’Œç©ºé—´ä»£ä»·ã€‚Java è™šæ‹Ÿæœºä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œå°±è®¾è®¡äº†å­—ç¬¦ä¸²å¸¸é‡æ± ï¼šç›¸åŒå­—é¢é‡çš„å¯¹è±¡åªæœ‰ä¸€ä¸ªã€‚

PPSï¼šJava è™šæ‹Ÿæœºåœ¨æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå†…å­˜åŒºåŸŸåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](http://www.itwanger.com/assets/images/2019/12/java-string-compare-3.png)






ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®é™…ä»£ç æ¥çœ‹çœ‹å­—ç¬¦ä¸²çš„æ¯”è¾ƒã€‚

ç¬¬ä¸€ç§ï¼š

```java
new String("å°èè‰").equals("å°èè‰") // --> true 
```

`.equals()` æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼Œæ‰€ä»¥ç»“æœä¸º trueã€‚

ç¬¬äºŒç§ï¼š

```java
new String("å°èè‰") == "å°èè‰" // --> false 
```

â€œ==â€æ“ä½œç¬¦å·¦ä¾§çš„å¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ï¼Œå³ä¾§çš„å¯¹è±¡å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼Œæ‰€ä»¥è¿”å› falseã€‚

ç¬¬ä¸‰ç§ï¼š

```java
new String("å°èè‰") == new String("å°èè‰") // --> false 
```

new å‡ºæ¥çš„ä¸¤ä¸ªå¯¹è±¡è‚¯å®šæ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥è¿”å› falseã€‚

ç¬¬å››ç§ï¼š

```java
"å°èè‰" == "å°èè‰" // --> true 
```

å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­åªä¼šæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¿”å› trueã€‚

```java
"å°èè‰" == "å°" + "èè‰" // --> true
```

ç”±äºâ€œå°â€å’Œâ€œèè‰â€éƒ½åœ¨å­—ç¬¦åˆ›å¸¸é‡æ± ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šå°†å…¶è‡ªåŠ¨ä¼˜åŒ–ä¸ºâ€œå°èè‰â€ï¼Œæ‰€ä»¥è¿”å› trueã€‚

ç»è¿‡å¤§é‡å®ä¾‹çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼ˆä¹Ÿæ˜¯å¯¹æé—®è€…çš„å›ç­”ï¼‰ï¼š

- å½“æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè¯·ä½¿ç”¨ `.equals()` æ–¹æ³•ã€‚

- å½“æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè¯·ä½¿ç”¨â€œ==â€æ“ä½œç¬¦ã€‚


å½“ç„¶äº†ï¼Œå¦‚æœè¦è¿›è¡Œä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„å†…å®¹æ¯”è¾ƒï¼Œé™¤äº† `.equals()` æ–¹æ³•ï¼Œè¿˜æœ‰å…¶ä»–å¯é€‰çš„æ–¹æ³•ã€‚

1ï¼‰`Objects.equals()`


`Objects.equals()` è¿™ä¸ªé™æ€æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºä¸éœ€è¦åœ¨è°ƒç”¨ä¹‹å‰åˆ¤ç©ºã€‚

```java
public static boolean equals(Object a, Object b) {
    return (a == b) || (a != null && a.equals(b));
}
```

å¦‚æœç›´æ¥ä½¿ç”¨ `a.equals(b)`ï¼Œåˆ™éœ€è¦åœ¨è°ƒç”¨ä¹‹å‰å¯¹ a è¿›è¡Œåˆ¤ç©ºï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆ `java.lang.NullPointerException`ã€‚

```java
Objects.equals("å°èè‰", new String("å°" + "èè‰")) // --> true
Objects.equals(null, new String("å°" + "èè‰")); // --> false
Objects.equals(null, null) // --> true

String a = null;
a.equals(new String("å°" + "èè‰")); // throw exception
```

2ï¼‰String ç±»çš„ `.contentEquals()`

`.contentEquals()` çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å°†å­—ç¬¦ä¸²ä¸ä»»ä½•çš„å­—ç¬¦åºåˆ—ï¼ˆStringBufferã€StringBuilderã€Stringã€CharSequenceï¼‰è¿›è¡Œæ¯”è¾ƒã€‚

```java
public boolean contentEquals(CharSequence cs) {
    // Argument is a StringBuffer, StringBuilder
    if (cs instanceof AbstractStringBuilder) {
        if (cs instanceof StringBuffer) {
            synchronized(cs) {
               return nonSyncContentEquals((AbstractStringBuilder)cs);
            }
        } else {
            return nonSyncContentEquals((AbstractStringBuilder)cs);
        }
    }
    // Argument is a String
    if (cs instanceof String) {
        return equals(cs);
    }
    // Argument is a generic CharSequence
    char v1[] = value;
    int n = v1.length;
    if (n != cs.length()) {
        return false;
    }
    for (int i = 0; i < n; i++) {
        if (v1[i] != cs.charAt(i)) {
            return false;
        }
    }
    return true;
}
```

ä»æºç ä¸Šå¯ä»¥çœ‹å¾—å‡ºï¼Œå¦‚æœ cs æ˜¯ StringBufferï¼Œè¯¥æ–¹æ³•è¿˜ä¼šè¿›è¡ŒåŒæ­¥ï¼Œéå¸¸çš„æ™ºèƒ½åŒ–ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨è¯¥æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿æ¯”è¾ƒçš„ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½ä¸ä¸º nullï¼Œå¦åˆ™å°†ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆã€‚

å†å¼ºè°ƒä¸€ç‚¹ï¼Œ`.equals()` æ–¹æ³•åœ¨æ¯”è¾ƒçš„æ—¶å€™éœ€è¦åˆ¤ nullï¼Œè€Œâ€œ==â€æ“ä½œç¬¦åˆ™ä¸éœ€è¦ã€‚

```java
System.out.println( null == null); // --> true
```

å¥½äº†å„ä½è¯»è€…æœ‹å‹ä»¬ï¼Œä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹äº†ã€‚**èƒ½çœ‹åˆ°è¿™é‡Œçš„éƒ½æ˜¯äººæ‰ï¼ŒäºŒå“¥å¿…é¡»è¦ä¸ºä½ ç‚¹ä¸ªèµ**ğŸ‘ã€‚å¦‚æœè§‰å¾—ä¸è¿‡ç˜¾ï¼Œè¿˜æƒ³çœ‹åˆ°æ›´å¤šï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘çš„[ä¸ªäººåšå®¢](http://www.itwanger.com/)ã€‚å¦å¤–å‘¢ï¼Œç»™å¤§å®¶ä¸€ä¸ªæ‰¿è¯ºï¼Œæˆ‘æ¯å‘¨éƒ½ä¼šæ›´æ–°ä¸€ç¯‡ã€Šç¨‹åºäººç”Ÿã€‹å’Œä¸€ç¯‡ Java æŠ€æœ¯æ ˆç›¸å…³çš„æ–‡ç« ï¼Œæ•¬è¯·æœŸå¾…ã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆé—®é¢˜éœ€è¦æˆ‘çš„å¸®åŠ©ï¼Œæˆ–è€…æƒ³å–·æˆ‘äº†ï¼Œæ¬¢è¿ç•™è¨€å“Ÿã€‚

å…»æˆå¥½ä¹ æƒ¯ï¼å¦‚æœè§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç‚¹ç”¨çš„è¯ï¼Œ**æ±‚ç‚¹èµã€æ±‚å…³æ³¨ã€æ±‚åˆ†äº«ã€æ±‚ç•™è¨€**ï¼Œè¿™å°†æ˜¯æˆ‘å†™ä¸‹å»çš„æœ€å¼ºåŠ¨åŠ›ï¼å¦‚æœå¤§å®¶æƒ³è¦ç¬¬ä¸€æ—¶é—´çœ‹åˆ°äºŒå“¥æ›´æ–°çš„æ–‡ç« ï¼Œå¯ä»¥æ‰«æä¸‹æ–¹çš„äºŒç»´ç ï¼Œå…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€‚æˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« è§ï¼

